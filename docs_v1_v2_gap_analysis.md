# rebuild-AgenticAI2 功能盘点与 1.0 对齐方案（初稿）

> 目标：保留 2.0「前后端分离 + 当前 UI 风格」，补齐你在 1.0 中已经验证有效的“任务处理 + 推理能力”。
>
> 说明：由于当前执行环境无法访问 GitHub 外网仓库（403），本文对 1.0 的判断仅基于你的描述（MVP、推理和任务处理更好）以及 2.0 现有代码结构做差距分析。

---

## 一、2.0 当前已经实现的能力（基于代码）

### 1) 架构与工程形态
- 已完成前后端分离：
  - 后端：FastAPI + SQLAlchemy（异步）
  - 前端：React + TypeScript + Zustand + Tailwind
- 前端有完整会话 UI：会话列表、消息流、输入区、新建会话、软删除会话。
- 后端具备会话持久化能力（SQLite）。

### 2) 推理主流程
- 已有 `ReasoningOrchestrator`（LangGraph）编排：
  - `classify -> cot/react -> finalize`
- 已有复杂度分类（`_is_complex_question`）进行策略路由。
- 已支持两类推理：
  - CoT（链式思考）
  - ReAct（工具调用循环，当前主要是 web search）
- 响应中写回了 `meta_info`（strategy/model/confidence/steps/reasoning_trace/mcp）。

### 3) 会话与历史
- 支持：创建会话、写入消息、读取历史、会话列表、软删除。
- 支持会话摘要（`summary`）和更新时间维护。

### 4) 上下文增强（MCP）
- 有 `MCPService`：提取意图、最近历史、历史计数，注入上下文 hint。

---

## 二、2.0 相比你描述的 1.0 可能“退化”的点（高概率）

> 根据当前 2.0 代码状态，推断导致“任务处理/推理变弱”的关键原因如下：

### 1) 多角色工作流在实现层基本缺失
- README 描述有“6 角色 + 6 阶段工作流”，但当前代码路径里并没有对应可执行的多角色流水线。
- 现状更像“单智能体 + 两种推理策略”而非“多角色协作式任务拆解/审查/交付”。

### 2) 任务导向产物未闭环
- API 响应结构中预留了 `code_modifications`、`suggestions`，但后端当前返回 `None`。
- 前端虽然有展示代码建议/安全提示的 UI，但后端没有稳定产出，导致“看起来支持、实际上缺能力”。

### 3) 工具生态很薄
- ReAct 里实际只接了 Tavily 搜索；没有文件系统读写、项目内检索、代码 diff 生成、命令执行等任务型工具。
- “能搜”不等于“能完成开发任务”。

### 4) RAG/知识库能力基本未落地
- 配置和 README 有 Qdrant/embedding 叙述，但当前后端 API 没有上传/切块/向量检索闭环。
- 缺少项目代码上下文后，复杂任务质量会明显下降。

### 5) 推理质量控制机制不足
- 复杂度分类、CoT 解析、ReAct action 解析都较脆弱（正则与模板依赖较强）。
- 缺少“计划-执行-验证-反思”回路与失败重试策略。

---

## 三、建议的“2.0 保架构复刻 1.0 能力”路线图

### Phase A：先恢复任务能力（不改 UI 风格）
1. **任务计划器（Planner）**
   - 先产出结构化任务计划（步骤、依赖、验收标准）。
2. **执行器（Executor）**
   - 对每一步选择工具：检索、读文件、改代码、生成补丁。
3. **验证器（Verifier）**
   - 自动跑测试/静态检查，失败回流给执行器修正。
4. **交付器（Reporter）**
   - 输出“做了什么、改了哪些文件、测试结果、风险点”。

> 这一步就能明显恢复你说的“能处理任务”。

### Phase B：恢复 1.0 的推理强项
1. **显式思维状态机**
   - `理解问题 -> 制定计划 -> 工具执行 -> 反思修正 -> 最终回答`
2. **复杂问题默认 ReAct + 反思**
   - 每轮动作后检查“是否偏离目标、是否信息不足”。
3. **失败可恢复机制**
   - 工具失败时：换策略、降级路径、解释不确定性。

### Phase C：把“多角色”真正做成可运行能力
1. 角色最小集建议：
   - PM（澄清需求）
   - Architect（方案）
   - Engineer（实现）
   - Reviewer（安全/质量）
2. 角色不要只做 prompt 标签，要有**职责约束 + 产物 schema**。

### Phase D：补齐 RAG（项目级上下文）
1. 文件上传与项目绑定。
2. 切块+向量化+检索。
3. 在 Planner/Executor/Reviewer 全链路注入检索结果。

---

## 四、建议的 API 演进（兼容现有前端）

在不推翻现有接口的前提下，扩展 `ChatResponse`：
- `workflow_state.current_phase`: 保留
- `workflow_state.phase_outputs`: 增加结构化计划/执行状态
- `code_modifications`: 输出标准化变更项（文件、类型、补丁）
- `suggestions`: 区分 `security_warnings`、`next_actions`

这样前端几乎不需要改风格，只需要显示更真实的数据。

---

## 五、下一步执行建议（可直接进入开发）

1. 先实现 `Planner + Executor + Verifier` 三节点 LangGraph。  
2. 把 `code_modifications` 从 `None` 改为真实产物。  
3. 接入最小 RAG（本地文件 + 向量检索）。  
4. 增加端到端回归测试（至少覆盖：普通问答、复杂任务、失败回退）。

---

## 六、阻塞说明
- 当前环境无法拉取你提供的 1.0 仓库（GitHub 403），因此暂时不能逐文件做“1.0 vs 2.0 精确 diff”。
- 只要你能提供以下任一项，我就可以下一轮给你出**精确功能映射表**（逐功能：是否实现、缺口、改造点、工时）：
  1) 1.0 仓库压缩包；
  2) 1.0 的核心文件（agent/workflow/tools/api）；
  3) 或临时开放可访问镜像地址。
